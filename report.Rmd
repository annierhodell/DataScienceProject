---
title: "Impact Of Covid-19 On A&E's In Scotland"
author: "by the A-Team: Anna Scollay, Alice Bullard, Alice Miller, Annie O'Dell"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%") # for better picture reolution
```


```{r load-lib, include = FALSE}
library(tidyverse)
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(devtools)
```

```{r load-data-2, include=FALSE}
#here we are loading all our data that we have used in our project
weekly_ae_activity_20231008 <- read_csv("data/weekly_ae_activity_20231008.csv") #our original dataset, unedited
HBT_area_names_and_population <- read_csv("data/HBT area names and population.csv")
Treatement_Location_names <- read_csv("data/Treatement Location names.csv")

#tidying our data
tidy.data <- weekly_ae_activity_20231008 %>%
  select(-Country, -DepartmentType) %>%
  mutate(WeekEndingDate = ymd(WeekEndingDate)) %>%
  mutate(PercentageOver4HoursEpisode = 
           round((NumberOver4HoursEpisode/NumberOfAttendancesEpisode)*100, digits = 1))

data.HBT.pop <- left_join(tidy.data, HBT_area_names_and_population, by ="HBT")

data.TLnames <- Treatement_Location_names%>%
  rename("TreatmentLocation" = "Postcode of Treatment Location")%>%
  left_join(data.HBT.pop, Treatement_Location_names, by ="TreatmentLocation")

col_order <- c("WeekEndingDate", "HBT", "Area name", "Population", "TreatmentLocation",
               "Name of Treatement Location", "NumberOfAttendancesEpisode", "NumberWithin4HoursEpisode",
               "PercentageWithin4HoursEpisode", "NumberOver4HoursEpisode", "PercentageOver4HoursEpisode", 
               "NumberOver8HoursEpisode", "PercentageOver8HoursEpisode", "NumberOver12HoursEpisode", "PercentageOver12HoursEpisode")

data.order <- data.TLnames[, col_order]

data <- data.order %>%
  rename("Week_Ending_Date" = "WeekEndingDate",
         "Health_Board_Area_Code" = "HBT", 
         "Health_Board_Area_Name" = "Area name", 
         "Area_Population" = "Population", 
         "Treatment_Location_Code" = "TreatmentLocation", 
         "Treatment_Location_Name" = "Name of Treatement Location",
         "Total_Attendees" = "NumberOfAttendancesEpisode", 
         "Attendees_within_4hrs" = "NumberWithin4HoursEpisode", 
         "%_within_4hr" = "PercentageWithin4HoursEpisode", 
         "Attendees_Over_4hrs" = "NumberOver4HoursEpisode",
         "%_Over_4hr" = "PercentageOver4HoursEpisode",
         "Attendees_Over_8hrs" = "NumberOver8HoursEpisode",
         "%_Over_8hr" = "PercentageOver8HoursEpisode", 
         "Attendees_Over_12hrs" = "NumberOver12HoursEpisode",
         "%_Over_12hr" = "PercentageOver12HoursEpisode")

#The Colours of HBT areas for graphs
health_board_area_colours <- c("Greater Glasgow and Clyde" = "red",
                               "Lothian" = "hotpink", "Ayrshire and Arran" = "pink", 
                               "Borders" = "seagreen", "Dumfries and Galloway" = "salmon",
                               "Fife" = "gold", "Forth Valley" = "cyan",
                               "Grampian" = "purple", "Highland" = "royalblue",
                               "Lanarkshire" = "mediumaquamarine", "Orkney" = "darkblue",
                               "Shetland" = "orange","Tayside" = "maroon",
                               "Western Isles" = "powderblue")
view(data)
```
http://libraryguides.vu.edu.au/c.php?g=386501&p=4347840 #reference info accessed 20/oct/2023

## Research Question

What effect did Covid-19 have on the number of attendees in emergency centers across Scotland, and did this vary by location?

In this project, we are aiming to investigate what impact Covid-19 has had on the number of attendees across A&Es in Scotland, and whether this varied between location. We would also like to use a model to predict how different A&E attendances would have been, if Covid-19 hadn't happened.

Note: Covid-19 predominately occurred in 2020.

## Data

Main data set: Weekly A&E Activity and Waiting Times.

This data set looks at the weekly attendances of each accident and emergency center in Scotland from 2015 to 2023. The data set includes the total amount of attendees at each center each week along with sectioning them into time taken to process the patient, either within 4 hours, over 4, over 8 or over 12 hours. 

Once the data was tidied, the key variables we are investigating are:

- Week_Ending_Date: The date at the end of the week(Sunday) when the data was taken,  spanning 22 February 2015 to 8 October 2023.

- Health_Board_Area_Name: The name which correlates to each HBT code, e.g S08000015 is for Ayrshire and Arran.

- Area_Population: The population for each HBT area.

- Total_Attendees: The total amount of attendees per week in each treatment location. 

## Findings

The write-up of your project and findings go here. 

Think of this as the text of your presentation with some extra detail to cover what there was not time to discuss in the presentation. This might include any assumptions you made when doing your analysis, any limitations of the work you have done or any ideas you have for future work. Feel free to split this section into subsections to make it easier to read. 

The length should be roughly 1,500 words. 
If you want to use a word count addin, you can install this by copying and pasting the following into RStudio:

devtools::install_github("benmarwick/wordcountaddin", type = "source", dependencies = TRUE)

You will then need to restart RStudio. Once you have done that, select the text you want to count the words of, go to Addins, and select the `Word count` addin.
This addin counts words using two different algorithms, but the results should be similar and as long as you're in the ballpark of 1,500 words, you're good! 
The addin will ignore code chunks and only count the words in prose. If you don't want to use the addin you can always copy and paste the text into Microsoft Word to do a Word Count!

You can also load your data here and present any analysis results / plots.
Make sure to hide your code with  `echo = FALSE` unless the point you are trying to make is about the code itself, in which case you should show your code.





## References

PHS Unscheduled Care Team 2023, *Weekly A&E Activity and Waiting Times*, data file

List any references here. You should, at a minimum, list your data source.


