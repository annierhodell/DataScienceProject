---
title: "Impact Of Covid-19 On A&E's In Scotland"
author: "The A-Team <br> Alice Bullard, Alice Miller, Annie O'Dell, Anna Scollay"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader: 
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: false
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(maps)
library(gridExtra)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
weekly_ae_activity_20231008 <- read_csv("data/weekly_ae_activity_20231008.csv")
HBT_area_names_and_population <- read_csv("data/HBT area names and population.csv")
Treatement_Location_names <- read_csv("data/Treatement Location names.csv")

tidy.data <- weekly_ae_activity_20231008 %>%
  select(-Country, -DepartmentType) %>%
  mutate(WeekEndingDate = ymd(WeekEndingDate)) %>%
  mutate(PercentageOver4HoursEpisode = 
           round((NumberOver4HoursEpisode/NumberOfAttendancesEpisode)*100, digits = 1))

data.HBT.pop <- left_join(tidy.data, HBT_area_names_and_population, by ="HBT")

data.TLnames <- Treatement_Location_names%>%
  rename("TreatmentLocation" = "Postcode of Treatment Location")%>%
  left_join(data.HBT.pop, Treatement_Location_names, by ="TreatmentLocation")

col_order <- c("WeekEndingDate", "HBT", "Area name", "Population", "TreatmentLocation",
               "Name of Treatement Location", "NumberOfAttendancesEpisode", "NumberWithin4HoursEpisode",
               "PercentageWithin4HoursEpisode", "NumberOver4HoursEpisode", "PercentageOver4HoursEpisode", 
               "NumberOver8HoursEpisode", "PercentageOver8HoursEpisode", "NumberOver12HoursEpisode", "PercentageOver12HoursEpisode")

data.order <- data.TLnames[, col_order]

data <- data.order %>%
  rename("Week_Ending_Date" = "WeekEndingDate",
         "Health_Board_Area_Code" = "HBT", 
         "Health_Board_Area_Name" = "Area name", 
         "Area_Population" = "Population", 
         "Treatment_Location_Code" = "TreatmentLocation", 
         "Treatment_Location_Name" = "Name of Treatement Location",
         "Total_Attendees" = "NumberOfAttendancesEpisode", 
         "Attendees_within_4hrs" = "NumberWithin4HoursEpisode", 
         "%_within_4hr" = "PercentageWithin4HoursEpisode", 
         "Attendees_Over_4hrs" = "NumberOver4HoursEpisode",
         "%_Over_4hr" = "PercentageOver4HoursEpisode",
         "Attendees_Over_8hrs" = "NumberOver8HoursEpisode",
         "%_Over_8hr" = "PercentageOver8HoursEpisode", 
         "Attendees_Over_12hrs" = "NumberOver12HoursEpisode",
         "%_Over_12hr" = "PercentageOver12HoursEpisode")
```


```{r include=FALSE}
style_xaringan(
  title_slide_background_image = "img/edinburgh-castle.jpg"
)
```

---
# our data/ how we tidied it etc/ where we got it, all that jazz

---

```{r Information on Scotland Data, include=FALSE}
data_table_1 <- data %>%
  group_by(Health_Board_Area_Name, Area_Population) %>%
  summarise(mean_attendances = round(mean(Total_Attendees), digits = 2)) %>%
  arrange(desc(mean_attendances))

```

```{r Scotland Information, echo = FALSE}
kable(head(data_table_1, n = 14), format = "html")
```
---
<<<<<<< HEAD
```{r Map Of Scotland - data, include=FALSE}
#data for the world map
worldmap <- read_csv("Data/Data Files/worldmap.csv")
```

```{r Map Of Scotland- plot, out.width="100%", fig.width=10, echo=FALSE}
#map of Scotland with HBT areas
worldmap %>%
  ggplot() + 
  geom_polygon(data = worldmap, 
               aes(x = long, y = lat, 
                   group = group), 
               fill = 'lightblue', 
               color = 'black') + 
  coord_fixed(ratio = 1.4, 
              xlim = c(-9,1), 
              ylim = c(54.8, 61))+
  theme_bw()+
  labs(title = "Map of Scotland's HBT Areas",
            stat = "unique",
            size = 5,
            color = "blue")+
  geom_text(aes(x = -0.2, y = 60.5,
                label = "Shetland"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -2, y = 59,
                label = "Orkney"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -4.7, y = 57,
                label = "Highland"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -8, y = 58,
                label = "Western Isles"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3, y = 57.4,
                label = "Grampian"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3.4, y = 56.2,
                label = "Fife"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3.6, y = 56.8,
                label = "Tayside"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -4.2, y = 56.5,
                label = "Forth Valley"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3, y = 55.8,
                label = "Lothian"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -2.3, y = 55.4,
                label = "Borders"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -4.1, y = 55.9,
                label = "GGC"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3.7, y = 55.5,
                label = "Lanarkshire"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3, y = 55.2,
                label = "Dumfries"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -3, y = 55.1,
                label = "& Galloway"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -4.3, y = 55.3,
                label = "Ayrshire"),
            stat = "unique",
            size = 3, color = "black")+
  geom_text(aes(x = -4.3, y = 55.2,
                label = "& Arran"),
            stat = "unique",
            size = 3, color = "black")
```
---
class: centre, middle

#  

class: center, middle

# Impact On Scotland Overall

```{r plot-graph 1, echo=FALSE}
data %>%
  select(Week_Ending_Date, Total_Attendees) %>%
  group_by(Week_Ending_Date) %>%
  summarise(Sum_Total_Attendees= sum(Total_Attendees)) %>%
  ggplot(aes(x = Week_Ending_Date, y = Sum_Total_Attendees)) +
  geom_line()+
  labs(x = "Date",
       y = "Sum of Total Attendees",
       title = "Number of A&E Attendees per Month",
       subtitle = 2015-2023) +
  theme_bw() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```
---

class: centre, middle

# Separating each year

```{r plot-graph-data 2, include=FALSE}
data_graph_1 <- data %>%
  mutate(Year = year(Week_Ending_Date)) %>%
  mutate(date = yday(Week_Ending_Date))
```

```{r plot-graph-2, echo=FALSE, message=FALSE, warning=FALSE}
data_graph_1 %>% 
  group_by(Week_Ending_Date) %>%
  summarise(sumdat=sum(Total_Attendees), Year, date) %>% 
  ggplot(aes(x = date, y = sumdat, colour = as.factor(Year))) +
  geom_line()+
  labs(x = "Day of Year",
       y = "Number of Attendees Across Scotland",
       title = "Number of A&E Attendees across each year",
       colour = "Year")
```

---
class: centre, middle
# Taking a Closer Look at 2020

```{r plot-graph 3, echo = FALSE, message=FALSE, warning=FALSE}
data %>%
  filter(year(Week_Ending_Date) == 2020) %>%
  select(Week_Ending_Date, Total_Attendees) %>%
  group_by(Week_Ending_Date) %>%
  summarise(Sum_Total_Attendees= sum(Total_Attendees)) %>%
  ggplot(aes(x = Week_Ending_Date, y = Sum_Total_Attendees)) +
  geom_line()+
  labs(x = "Date",
       y = "Sum of Total Attendees",
       title = "Number of Attendees Per Week In 2020")+
  theme_bw() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```
---
#average by hbt area
---
#number of attendees per area as a percentage of the population
---
=======
>>>>>>> 7aa0c50a7f2a542c34dcd27001418ee06efc45b7
