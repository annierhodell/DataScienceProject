---
title: "Investigating the Corellation Between The Diet of Birds and Their Beak Measurement"
#subtitle: "Presentation subtitle (if any)"
author: "A-Team <br> Alice Bullard, Alice Miller, Annie O'Dell, Anna Scollay"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(ggplot2)
library(gridExtra)
library(tidymodels)
library(readxl)
library(xaringan)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
birds_data_og <- read_csv("birds_data.csv")

birds_data <- birds_data_og %>%
  select(Species1, Family1, Order1, Avibase.ID1, Total.individuals,
         Complete.measures, Beak.Length_Culmen, Beak.Length_Nares, Beak.Width, Beak.Depth, 
         Tarsus.Length, Wing.Length, Kipps.Distance, Secondary1, Tail.Length, 
         Trophic.Level, Trophic.Niche) %>%
  rename("Species_Name" = "Species1", "Family" = "Family1", "Order" = "Order1",
         "Species_ID" = "Avibase.ID1",
         "Secondary_Length" = "Secondary1",
         "Complete_Measures" = "Complete.measures", "Total_Individuals" = "Total.individuals",
         "Beak_Culmen_Length" = "Beak.Length_Culmen", "Beak_Nares_Length" = "Beak.Length_Nares",
         "Beak_Width" = "Beak.Width", "Beak_Depth" = "Beak.Depth", "Tarsus_Length" = "Tarsus.Length",
         "Wing_Length" = "Wing.Length", "Kipps_Distance" = "Kipps.Distance", "Tail_Length" = "Tail.Length",
         "General_Trophic" = "Trophic.Level", 
         "Niche_Trophic" = "Trophic.Niche") %>%
  relocate(Species_ID, .before = Species_Name)
```

##Our Data
We chose the AVONET data set which outlines functional trait data for all birds including data on:
- Species
- Habitat
- Trophic (diet)
- Different Beak size data including: Beak width, Beak Depth and two measures of Beak length
...

```{r showing the data, echo=FALSE}
birds_data %>%
  select(Species_Name, Family, Beak_Nares_Length, Beak_Depth, Beak_Width, General_Trophic, Niche_Trophic) %>%
  print(n = 10)
```
---
#Steps We Took To Tidy The Data

##Firstly we checked the data for NA's
```{r data tidying code, echo=TRUE}
birds_data_og %>% 
  select(where(~ any(is.na(.)))) %>% 
  summarise(
    across(everything(),
           ~sum(is.na(.))))
```

---
#Then we selected the columns that were useful to our investiagtion

```{r data Tidying select, echo=TRUE}
birds_data_select <- birds_data_og %>%
  select(Species1, Family1, Order1, Avibase.ID1, Total.individuals, Female, Male, Unknown,
         Complete.measures, Beak.Length_Culmen, Beak.Length_Nares, Beak.Width, Beak.Depth, 
         Tarsus.Length, Wing.Length, Kipps.Distance, Secondary1, `Hand-Wing.Index`, Tail.Length, 
         Mass, Habitat, Habitat.Density, Migration, Trophic.Level, Trophic.Niche, 
         Primary.Lifestyle, Range.Size) 

```
---
#We then renamed the column's that had unclear names
```{r rename data tidying, echo=TRUE}
birds_data_rename <- birds_data_select%>%
  rename("Species_Name" = "Species1", "Family" = "Family1", "Order" = "Order1",
         "Species_ID" = "Avibase.ID1", "Unknown_M/F" = "Unknown", 
         "Secondary_Length" = "Secondary1","Avg_Mass" = "Mass",
         "Hand_Wing_Index" = "Hand-Wing.Index","Complete_Measures" = "Complete.measures", 
         "Total_Individuals" = "Total.individuals","Beak_Culmen_Length" = "Beak.Length_Culmen", 
         "Beak_Nares_Length" = "Beak.Length_Nares","Beak_Width" = "Beak.Width", 
         "Beak_Depth" = "Beak.Depth", "Tarsus_Length" = "Tarsus.Length",
         "Wing_Length" = "Wing.Length", "Kipps_Distance" = "Kipps.Distance", 
         "Tail_Length" = "Tail.Length","Habitat_Density" = "Habitat.Density", 
         "General_Trophic" = "Trophic.Level", "Niche_Trophic" = "Trophic.Niche", 
         "Primary_Lifestyle" = "Primary.Lifestyle","Range_Size" = "Range.Size")
```
---
#Finally we relocated the Species ID to come before the Species Name
```{r relocate data tidying, include=TRUE}
birds_data_relocate <- birds_data_rename%>%
  relocate(Species_ID, .before = Species_Name)
```

---

class: center, middle

##Investigating the Corellation Between The Diet of Birds and Their Beak Measurement

Our aim is to prove that birds with similar diets will have similar beak sizes.
---

class:center, middle
##What Is A Bird's Beak Measurements
```{r Beak Size Image, echo=FALSE, out.width= "50%"}
include_graphics("Watercolor_painted_beautiful_bird,_Hand_drawn_colorful_bird.jpg")
```
---
##Data on types of diets

Our data had two options for the 'Type of diet' for the birds:

- General Trophic which included: Carnivore, Herbivore, Omnivore and Scavenger

- Niche Tropic which included: Aquatic Predator, Grainivore, Herbivore terrestrial, Nectarivore, Scavenger, Frugivore, Herbivore Aquatic, Invertivore, Omnivore and Vertivore


```{r pie chart, echo=FALSE, out.width= "55%", class='middle', fig.align='center'}
trophic_colors <- c("Herbivore" = "darkgreen",
                    "Carnivore" = "tomato3",
                    "Omnivore" = "steelblue",
                    "Scavenger" = "wheat")

pie_chart_general_trophic <- birds_data %>%
  filter(!is.na(General_Trophic)) %>%
  ggplot(aes(x = "", fill = General_Trophic)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar(theta = "y") +
  scale_fill_manual(values = trophic_colors, name = "Trophic Type") +  # Assign colors and change legend name
  guides(fill = guide_legend(title = element_blank(), ncol = 3, keywidth=0.2, keyheight=0.5)) +  # Change legend name
  theme(axis.text = element_blank(),  # Remove axis text
        axis.title = element_blank(),  # Remove axis title
        legend.position = "bottom",
        legend.text = element_text(size =10),
        legend.title = element_text(size = 12))  


pie_chart_niche_trophic <- birds_data %>%
  filter(!is.na(Niche_Trophic)) %>%
  ggplot(aes(x = "", fill = Niche_Trophic)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar(theta = "y") +
  #scale_fill_manual(values = trophic_colors, name = "Trophic Type") +  # Assign colors and change legend name
  guides(fill = guide_legend(title = element_blank(),ncol = 2, keywidth=0.2, keyheight=0.5)) +  # Change legend name
  theme(axis.text = element_blank(),  # Remove axis text
        axis.title = element_blank(),  # Remove axis title
        legend.position = "bottom",
        legend.text = element_text(size = 10),
        legend.title = element_text(size = 12))


grid.arrange(pie_chart_general_trophic, pie_chart_niche_trophic, ncol = 2,
             widths = c(10, 13))

#find a way to move the figure up on the presentation
```
---
##Varience in beak data between the general trophics

- There is not a huge difference between the different general trophics, as shown below, so we decided to look more specifically at the niche trophics

```{r bar chart of general trophics, echo=FALSE, out.width="50%", class='middle', fig.align='center'}
birds_data %>%
  select(General_Trophic, Beak_Width, Beak_Depth, Beak_Nares_Length) %>%
  filter(!is.na(General_Trophic)) %>%
  group_by(General_Trophic) %>%
  summarise(Width = mean(Beak_Width), Depth = mean(Beak_Depth), Length = mean(Beak_Nares_Length)) %>%
  gather(key = variable, value = Value, Width, Length, Depth) %>%
  ggplot() +
  geom_col(mapping = aes(y = General_Trophic,
                         x = Value,
                         fill = variable),
           position = "dodge")+
  labs(title = "Beak Data against General Trophic",
       x = "Beak Data",
       y = "Trophic")

```
---
##Variance in Beak data between the Niche Tropics

- There is a more clear distinction between the different niche trophics than there was for the general trophics

```{r bar chart of niche trophics, echo = FALSE, out.width="50%", class='middle', fig.align='center'}
birds_data %>%
  select(Niche_Trophic, Beak_Width, Beak_Depth, Beak_Nares_Length) %>%
  filter(!is.na(Niche_Trophic)) %>%
  group_by(Niche_Trophic) %>%
  summarise(Width = mean(Beak_Width), Depth = mean(Beak_Depth), Length = mean(Beak_Nares_Length)) %>%
  gather(key = variable, value = Value, Width, Length, Depth) %>%
  ggplot() +
  geom_col(mapping = aes(y = Niche_Trophic,
                         x = Value,
                         fill = variable),
           position = "dodge")+
  labs(title = "Beak Data against Niche Trophic",
       x = "Beak Data",
       y = "Trophic")
```
---
##How much data is there for each trophic
```{r pie chart of niche trophics, echo=FALSE, out.width= "60%", fig.align='center', class='middle'}
birds_data %>%
  filter(!is.na(Niche_Trophic)) %>%
  ggplot(aes(x = "", fill = Niche_Trophic)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar(theta = "y") +
  #scale_fill_manual(values = trophic_colors, name = "Trophic Type") +  # Assign colors and change legend name
  guides(fill = guide_legend(title = "Trophic Type", nrow = 3)) +  # Change legend name
  labs(title = "Distribution of Trophic Types") +
  theme(axis.text = element_blank(),  # Remove axis text
        axis.title = element_blank(),  # Remove axis title
        legend.position = "bottom")
```
- Since there is the most data for Invertivores, we decided to focus predicting whether or not a bird was an Invertivore or not based on beak measurements for our models.
---
##Comparison of Invertivores against Not Invertivores

- There is a clear difference between the beak data for invertivores vs not invertivores so we decided to use this data to base our model
```{r bar chart of invertivores vs not invertivores, echo=FALSE, out.width= "60%", fig.align='center', class='middle'}
birds_data %>%
  select(Niche_Trophic, Beak_Width, Beak_Depth, Beak_Nares_Length) %>%
  filter(!is.na(Niche_Trophic)) %>%
  mutate(Invertivore_Status = ifelse(Niche_Trophic == "Invertivore", "Invertivore", "Not Invertivore")) %>%
  group_by(Invertivore_Status) %>%
  summarise(Width = mean(Beak_Width), Depth = mean(Beak_Depth), Length = mean(Beak_Nares_Length)) %>%
  gather(key = variable, value = Value, Width, Length, Depth) %>%
  ggplot() +
  geom_col(mapping = aes(y = Invertivore_Status,
                         x = Value,
                         fill = variable),
           position = "dodge")+
  labs(title = "Beak Measurements vs Invertivore status",
       x = "Beak Measurements",
       y = "Invertivore status")+
  guides(fill = guide_legend(title = "Type of Beak Measurement"))
```
---
class:center, middle
#Our Model
Predicting whether a bird is an invertivore or not based of the length, depth and width of their beak

---
##What is an invertivore?
- An invertivore is a type of carnivore 
- More than 60% of its diet is made up of invertibrates
- Some examples of breeds of invertivore in our data set are Abroscopus albogularis and Acanthidops bairdi
- They are most commonly found in the Shrubland and Woodland habitats

```{r facts abour invertivores, echo=FALSE, include=FALSE}
#birds_data %>%
#  filter(Niche_Trophic == "Invertivore") %>%
#  count(Species_Name) %>%
#  arrange(desc(n))
#birds_data %>%
#  filter(Niche_Trophic == "Invertivore") %>%
#  count(Habitat) %>%
#  arrange(desc(n))
```
---

#Prediciting Whether a Bird is an Invertivore
```{r Bird Model data tidying, include=FALSE}
birds_model_2 <- birds_data %>%
  select(Niche_Trophic, Beak_Width, Beak_Depth, Beak_Nares_Length) %>%
  filter(!Niche_Trophic == "NA") %>%
  mutate(Invertivore_Status = factor(ifelse(Niche_Trophic == "Invertivore", "Invertivore", "Not Invertivore"),
         levels = c("Not Invertivore", "Invertivore")))
#splitting our data

# Set seed for reproducibility
set.seed(5956)
# Create an initial split (e.g., 80% training, 20% testing)
split_data_2 <- initial_split(birds_model_2, prop = 0.8)
train_data_2 <- training(split_data_2)
test_data_2 <- testing(split_data_2)
```

```{r Workflow Model for Carnivore, include=FALSE}

#model for predicting if a invertivore or not based on beak data (model v)
birds_rec_v <- recipe(Invertivore_Status ~ Beak_Nares_Length + Beak_Width + Beak_Depth,
                      data = train_data_2) %>%
  step_dummy(all_nominal(), -all_outcomes())

birds_mod_v <- logistic_reg() %>%
  set_engine("glm")

birds_wflow_v <- workflow() %>%
  add_recipe(birds_rec_v) %>%
  add_model(birds_mod_v)

birds_wflow_v

birds_fit_v <- birds_wflow_v %>%
  fit(data = train_data_2)

birds_predict_v <- predict(birds_fit_v, test_data_2, type = "prob") %>%
  bind_cols(test_data_2)

# ROC for Invertivore
roc_Invertivore <- birds_predict_v %>%
  roc_curve(truth = Invertivore_Status, ".pred_Invertivore", event_level = "second")
```

```{r Graph for Model for Carnivore, echo=FALSE}
# Plot ROC for Invertivore
autoplot(roc_Invertivore) +
  labs(title = "ROC Curve for prediciting Invertivores",
       subtitle = "Using Beak Nares Length, Beak Width and Beak Depth")

```
---
#Prediciting Whether a Bird is a Invertivore
```{r area under the curve for carnivore, echo=TRUE}
#Area under curve
birds_predict_v%>%
  roc_auc(truth = Invertivore_Status, ".pred_Invertivore", event_level = "second")
```

- This calculates the area under the curve. 
- Our value for this area 0.74 which is greater than 0.5 which is said to be random choice.
---
class: center, middle
##Results of our Investigation

- Our model had an ROC value of 0.74 when using the three different types of beak data to predict whether or not the bird is an invertivore
- 
